# UDP
+ UDP是一种保留消息边界的简单的面向数据报的传输层协议，它不提供差错纠正、队列管理、重复消除、流量控制和拥塞控制。它提供差错检测，包含end-to-end校验和。
+ 这种协议自身提供最小功能，因此使用它的应用程序要做许多关于数据包如何发送和处理的控制工作。想要保证数据被可靠投递或正确排序，应用程序必须自己实现这些保护功能。
+ UDP是面向数据报的协议，也就是说每个应用程序请求的UDP输出操作只产生一个UDP数据报，从而发送一个IP数据报。不同与面向数据流(字节流)的协议，例如TCP,应用程序写入的全部数据与真正在单个IP数据报里传送的或接收方接收的内容可能没有联系。
+ UDP不提供差错纠正，也就是说它把应用程序传给IP层的数据发送出去，但并不保证它们能到达目的地。另外，没有协议机制防止高速UDP对其他网络用户的消极影响。
+ 因为UDP的无连接特性，它要比其他的传输协议使用更少的开销。另外，广播和组播操作更多直接使用类似UDP这样的无连接传输，另外，应用程序可选择自己的重传单元的能力是一项重要的考虑。
+ IPv4 protocol字段用17来标识。 IPv6在 Next protocol字段使用相同的值。
+ IP层根据IPv4头部中的协议字段或IPv6头部中的下一个头部字段的值将IP数据报分离到特定的传输协议，这意味着端口号在不同的传输协议之间是独立的，也就是说tcp端口号只能被tcp使用，udp端口号只能被udp使用。这导致了两个服务器可以使用相同的端口号和ip地址，只要它们使用不同的传输协议。

## UDP校验和
+ 覆盖了UDP头部，UDP数据和一个伪头部，由初始的发送方计算得到，由最终的目的方校验。同时，IPv4头部中的校验和只覆盖整个头部，并不覆盖IP分组中的任何数据，它在每个IP跳都要被重新计算，因为IPv4TTL字段的值在数据报转发时会被路由器减少。
+ UDP校验和可选。
+ UDP数据报长度可以是奇数个字节，所以计算校验和是追加一个0,并不发送，同时，为了检测UDP是否发送到正确的地址，检测是否是UDP,会在计算校验和是，引入一个来自IPv4头部字段的一个12字节的伪头部，或者一个来自IPv6头部字段的40个字节的伪头部。注意只是计算使用，并不会发送。UPD校验和，包含了伪头部，UDP头部和数据。
+ 一旦出现检错，数据报就会被丢弃，不会产生差错消息，但可能会更新一些统计信息。

## UDP-Lite
+ 有些应用程序可以容忍在发送和接收的数据里引入的比特差错，但是UDP使用的校验和要么覆盖整个负载，要么就一点也没有，一个成为UDP—Lite或UDPLite的协议通过修改传统的UDP协议，提供了部分校验和来解决这个问题，这些校验和只覆盖每个UDP数据报里的一部分负载。UDP-Lite有自己的协议号，IPv4和IPv6 136,UDP-Lite用一个校验和覆盖范围字段取代了长度字段来修改UDP头部，除特殊值0以外，最小值是8,因为UDP-Lite头部自身总是要求被校验和覆盖，值0表示整个负载都被校验和覆盖。

## IP分片和重组
+ 链路层通常对可传输帧有最大长度上限。为了保持IP数据报抽象与链路层细节的一致与分离，IP引入分片和重组，当IP层接收到了一个要发送的IP数据报，它会判断该数据报应该从那个本地接口发送，(通过查找转发表，以及要求的MTU),IP比较MTU和数据大小，当数据太大进行分片。
+ 当IP数据分片之后，只在目的地进行重组，原因有二：<br>
  1. 不进行重组会减轻路由器转发的软硬件压力，但对于现代路由器的性能来说这不是重要的。 <br>
  2. 同一个数据报的不同分片可能经由不同的路径到达目的地，这就是说，对于每个路由器接收到的数据分片可能是不完整的，每能力进行重组。
+ 分片和重组有一个另人失望的特性，如果任何一个分片丢失，整个数据报就丢失。IP层自身没有差错纠正机制，这是更高layer的责任，如果搭载TCP,则会进行超时重传，这只能重传整个TCP数据报，只重传一个分片是不可能的。因为，如果路由器进行了分片处理，源主机，不会知道是哪个片。
+ 一个数据报的任何一个分片首先到达是，IP层会启动一个计时器，否则，不能到达的分片最终会导致接收方用尽缓存。除非接收到了第一个分片，否则没必要产生ICMP错误。
+ 总的来说，对于UDP协议来说，如果能发现链路MTU，是令人可喜的。因此，引入路径MTU发现机制 PMTUD。传统的PMTUD使用ICMP PTB消息，来获得一个最大分组大小，其沿着一条路径传输不会引入分片。
+ ISP通用最小1500字节MTU,有些ISP引入PPPoE,支持地址分配和管理，使用更小的1492MTU。PPPoE头部由6字节和随后2字节PPP头部组成，剩下1492字节用于封装数据报。

## 分组与ARP
+ ARP和分组，有一些不可调和的问题，对于所有的IP分组，如果这些IP在局域网内未绑定MAC地址，我们需要发送ARP报文，获取绑定，那么对于同一个上层协议的多个IP分片，我们应该发送多个ARP报文，(这有可能会造成类似ARP洪泛攻击的情况，解决方法是限定最大发送速率)，还是将其排入队列，等待第一个分片发送ARP,更新ARP缓存，(这可能会丢失分组，解决方法是提供一个更大的队列，？神奇的解决方法？)

### UDP不同于TCP,因为是基于数据报的协议，如果socket指定接收一个小于数据报长度的最大字节数，对于余下的数据，会出现截断，基于不同的操作系统可能会有不同的截断方法。而TCP没有消息边界，因此，应用程序可以得到它请求的任意大小的数据量，可供给充足的数据，如果不行，通常可以等待。
